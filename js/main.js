(()=>{var t={257:t=>{t.exports={suits:["♥","♦","♣","♠"]}},963:(t,e,s)=>{const r=s(854),n=s(328),{suits:i}=s(257),a=document.getElementById("js-resetBtn"),h=document.querySelectorAll(".js-tramp"),o=document.getElementById("js-win"),l=document.getElementById("js-lose"),m=document.getElementById("js-percent"),p=document.getElementById("js-count"),u=document.getElementById("js-turn"),c=document.getElementById("js-trashArea");t.exports=class{setTramp(){for(let t=0;t<i.length;t++)for(let e=1;e<=13;e++){const s=new r(i[t],e);this.tramps.push(s)}this.tramps=n.shuffle(this.tramps),this.preloadTramp()}preloadTramp(){for(let t=0;t<this.tramps.length;t++){const e=this.tramps[t],s=`images/${e.suit}-${e.num}.png`,r=document.createElement("img");r.src=s,this.preloadTramps.push(r)}}setResetListener(){a.addEventListener("click",(()=>{a.innerText="リセット",this.resetGame()}))}resetGame(){this.tramps.length=0,this.trashTramps.length=0,this.preloadTramps.length=0,this.turn=1,this.winCount=0,this.loseCount=0,this.winPercent=0,this.setTramp(),this.displayScore(),this.renderTrashTramp(),this.renderTramp()}battle(){h.forEach((t=>{t.addEventListener("click",(async t=>{if(!this.tramps.length||this.flag)return;this.flag=!0;const e=t.currentTarget,s=this[e.dataset.key],r=this["first"===e.dataset.key?"second":"first"];this.renderTramp(!0),await n.sleep(500);let i={};"ally"===n.actionBattle(s,r)?(i=s,this.winCount++):(i=r,this.loseCount++),alert(`${r.suit}${n.convertTrampPattern(r.num)} vs ${s.suit}${n.convertTrampPattern(s.num)} :selected\n${i.suit}${n.convertTrampPattern(i.num)} :victory`),this.flag=!1,this.nextGame()}))}))}async nextGame(){this.tramps.splice(0,2);const t=this.preloadTramps.slice(0,2);if(this.trashTramps.push(t[0]),this.trashTramps.push(t[1]),this.preloadTramps.splice(0,2),this.tramps.length&&this.turn++,this.displayScore(),this.renderTrashTramp(),!this.tramps.length)return await n.sleep(500),alert(n.checkRank(this.winPercent)),void(a.innerText="もう一度あそぶ");this.renderTramp()}displayScore(){if(u.innerText=this.turn,p.innerText=this.tramps.length,o.innerText=this.winCount,l.innerText=this.loseCount,1===this.turn)return void(m.innerText="0");let t=0;const e=this.winCount/(this.winCount+this.loseCount),s=String(e).split(".");s[1]&&s[1].length>=2?(t=Math.round(this.winCount/(this.winCount+this.loseCount)*100*10)/10,m.innerText=t):(t=100*e,m.innerText=t),this.winPercent=t}renderTrashTramp(){this.trashTramps.length?(c.appendChild(this.trashTramps[this.trashTramps.length-1]),c.appendChild(this.trashTramps[this.trashTramps.length-2])):c.textContent=""}renderTramp(t=!1){if(this.first=this.tramps[0],this.second=this.tramps[1],t)return h[1].textContent="",void h[1].appendChild(this.preloadTramps[1]);h[0].textContent="",h[0].appendChild(this.preloadTramps[0]),h[1].innerHTML='<img src="images/back.png">'}}},854:t=>{t.exports=class{constructor(t,e){this.suit=t,this.num=e}}},328:(t,e,s)=>{const{suits:r}=s(257);t.exports={sleep:async t=>new Promise((e=>setTimeout(e,t))),checkRank:t=>100===t?"PERFECT":t>=60?"EXCELLENT":t>=40?"OK":"NOOB",actionBattle:(t,e)=>{let s={};return s=t.num===e.num?r.findIndex((e=>e===t.suit))>r.findIndex((t=>t===e.suit))?"ally":"enemy":1===t.num?"ally":1===e.num?"enemy":t.num>e.num?"ally":"enemy",s},convertTrampPattern:t=>{let e;switch(t){case 1:e="A";break;case 11:e="J";break;case 12:e="Q";break;case 13:e="K";break;default:e=t}return e},shuffle:([...t])=>{for(let e=t.length-1;e>=0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}}}},e={};function s(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,s),i.exports}(()=>{const t=s(963);(new class extends t{tramps=[];trashTramps=[];preloadTramps=[];first={};second={};turn=1;winCount=0;loseCount=0;flag=!1;init(){this.setResetListener(),this.setTramp(),this.renderTramp(),this.displayScore(),this.battle()}}).init()})()})();