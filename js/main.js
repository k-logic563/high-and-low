(()=>{var t={257:t=>{t.exports={suits:["♥","♦","♣","♠"]}},963:(t,e,s)=>{const n=s(854),r=s(328),{suits:i}=s(257),a=document.getElementById("js-resetBtn"),h=document.querySelectorAll(".js-tramp"),o=document.getElementById("js-win"),m=document.getElementById("js-lose"),l=document.getElementById("js-percent"),p=document.getElementById("js-count"),u=document.getElementById("js-turn"),c=document.getElementById("js-trashArea");t.exports=class{setTramp(){for(let t=0;t<i.length;t++)for(let e=1;e<=13;e++){const s=new n(i[t],e);this.tramps.push(s)}this.tramps=r.shuffle(this.tramps),this.preloadTramp()}preloadTramp(){for(let t=0;t<this.tramps.length;t++){const e=this.tramps[t],s=`images/${e.suit}-${e.num}.png`,n=document.createElement("img");n.src=s,this.preloadTramps.push(n)}}setResetListener(){a.addEventListener("click",(()=>{a.innerText="リセット",this.resetGame()}))}resetGame(){this.tramps.length=0,this.trashTramps.length=0,this.preloadTramps.length=0,this.turn=1,this.winCount=0,this.loseCount=0,this.winPercent=0,this.setTramp(),this.displayScore(),this.renderTrashTramp(),this.renderTramp()}battle(){h.forEach((t=>{t.addEventListener("click",(async t=>{if(!this.tramps.length||this.flag)return;this.flag=!0;const e=t.currentTarget,s=this[e.dataset.key],n=this["first"===e.dataset.key?"second":"first"];this.renderTramp(!0),await r.sleep(500);let i={};"ally"===r.actionBattle(s,n)?(i=s,this.winCount++):(i=n,this.loseCount++),alert(`${n.suit}${r.convertTrampPattern(n.num)} vs ${s.suit}${r.convertTrampPattern(s.num)} :selected\n${i.suit}${r.convertTrampPattern(i.num)} :victory`),this.flag=!1,this.nextGame()}))}))}async nextGame(){if(this.tramps.splice(0,2),this.preloadTramps.splice(0,2),this.trashTramps.push(this.first),this.trashTramps.push(this.second),this.tramps.length&&this.turn++,this.displayScore(),this.renderTrashTramp(),!this.tramps.length)return await r.sleep(500),alert(r.checkRank(this.winPercent)),void(a.innerText="もう一度あそぶ");this.renderTramp()}displayScore(){if(u.innerText=this.turn,p.innerText=this.tramps.length,o.innerText=this.winCount,m.innerText=this.loseCount,1===this.turn)return void(l.innerText="0");let t=0;const e=this.winCount/(this.winCount+this.loseCount),s=String(e).split(".");s[1]&&s[1].length>=2?(t=Math.round(this.winCount/(this.winCount+this.loseCount)*100*10)/10,l.innerText=t):(t=100*e,l.innerText=t),this.winPercent=t}renderTrashTramp(){this.trashTramps.length?c.innerHTML=this.trashTramps.map((t=>`<img src="images/${t.suit}-${t.num}.png">`)).join(""):c.innerHTML=""}renderTramp(t=!1){if(this.first=this.tramps[0],this.second=this.tramps[1],t)return h[1].textContent="",void h[1].appendChild(this.preloadTramps[1]);h[0].textContent="",h[0].appendChild(this.preloadTramps[0]),h[1].innerHTML='<img src="images/back.png">'}}},854:t=>{t.exports=class{constructor(t,e){this.suit=t,this.num=e}}},328:(t,e,s)=>{const{suits:n}=s(257);t.exports={sleep:async t=>new Promise((e=>setTimeout(e,t))),checkRank:t=>100===t?"PERFECT":t>=60?"EXCELLENT":t>=40?"OK":"NOOB",actionBattle:(t,e)=>{let s={};return s=t.num===e.num?n.findIndex((e=>e===t.suit))>n.findIndex((t=>t===e.suit))?"ally":"enemy":1===t.num?"ally":1===e.num?"enemy":t.num>e.num?"ally":"enemy",s},convertTrampPattern:t=>{let e;switch(t){case 1:e="A";break;case 11:e="J";break;case 12:e="Q";break;case 13:e="K";break;default:e=t}return e},shuffle:([...t])=>{for(let e=t.length-1;e>=0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}}}},e={};function s(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,s),i.exports}(()=>{const t=s(963);(new class extends t{tramps=[];trashTramps=[];preloadTramps=[];first={};second={};turn=1;winCount=0;loseCount=0;flag=!1;init(){this.setResetListener(),this.setTramp(),this.renderTramp(),this.displayScore(),this.battle()}}).init()})()})();